<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–ù–æ–≤–æ—Å—Ç–∏ –ú–æ—Å–∫–≤–∞ ¬∑ –∏–≥—Ä–æ–≤–æ–π –ø–æ—Ä—Ç–∞–ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(circle at 10% 30%, #ffe5e5, #dfe9ff, #c2d9ff);
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
        }

        /* –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç */
        .app {
            max-width: 1300px;
            width: 100%;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: clamp(32px, 5vw, 56px);
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.6);
            padding: clamp(20px, 4vw, 40px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* —à–∞–ø–∫–∞ */
        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 24px 20px;
            margin-bottom: 40px;
        }
        .title-block {
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            gap: 12px 20px;
        }
        .title-block h1 {
            font-size: clamp(2rem, 7vw, 3.5rem);
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(135deg, #1e2a5e, #540d6e);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 4px 4px 12px rgba(0,0,0,0.1);
        }
        .badge {
            background: rgba(255, 70, 70, 0.8);
            backdrop-filter: blur(4px);
            color: white;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 60px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            box-shadow: 0 10px 20px -5px rgba(255, 0, 0, 0.3);
            border: 1px solid white;
        }
        .actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        .btn {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            padding: 14px 28px;
            border-radius: 60px;
            font-weight: 600;
            font-size: clamp(1rem, 3vw, 1.2rem);
            cursor: pointer;
            box-shadow: 0 8px 20px -8px rgba(0,0,0,0.2);
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #1a1a2e;
        }
        .btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.03);
            border-color: #540d6e;
        }
        .btn:active { transform: scale(0.98); }

        /* –ª–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π ‚Äî –≥—Ä–∏–¥ */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 28px;
            margin: 30px 0 20px;
            transition: 0.3s;
        }
        /* –∫–∞—Ä—Ç–æ—á–∫–∞ */
        .news-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 36px;
            padding: 18px 18px 24px;
            box-shadow: 0 15px 30px -10px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.8);
            transition: all 0.15s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .news-card:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-8px);
        }
        /* –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .card-img {
            width: 100%;
            height: 180px;
            border-radius: 28px;
            background: rgba(220, 220, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 20px;
            object-fit: cover;
            border: 2px solid white;
        }
        .card-img img {
            width: 100%;
            height: 100%;
            border-radius: 26px;
            object-fit: cover;
        }
        .card-title {
            font-size: 1.7rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 12px;
            padding: 0 6px;
        }
        .card-desc {
            font-size: 1rem;
            line-height: 1.4;
            color: #1e1e3f;
            padding: 0 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞) */
        .delete-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 44px;
            height: 44px;
            background: #ff3b3b;
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255,0,0,0.5);
            transition: 0.2s;
            z-index: 10;
            opacity: 0;
            transform: scale(0.7);
            pointer-events: none;
        }
        .edit-mode .delete-btn {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
        .delete-btn:hover {
            background: #d00000;
            transform: scale(1.1);
        }

        /* –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä */
        .news-detail {
            background: rgba(255,255,255,0.35);
            backdrop-filter: blur(12px);
            border-radius: 48px;
            padding: 32px;
            margin-top: 20px;
            border: 2px solid white;
        }
        .back-btn {
            background: none;
            border: none;
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 20px;
            cursor: pointer;
            color: #1e2a5e;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .detail-title {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 30px;
        }
        .detail-text {
            font-size: 1.3rem;
            line-height: 1.6;
            white-space: pre-wrap;
            margin: 30px 0;
        }
        .detail-photo-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 25px 0;
            justify-content: center;
        }
        .detail-photo-row img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 32px;
            box-shadow: 0 15px 25px -8px black;
            border: 3px solid white;
        }

        /* –º–æ–¥–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-container {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(30px);
            border-radius: 56px;
            padding: 36px;
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(255,255,255,0.9);
            box-shadow: 0 30px 60px -20px black;
        }
        .modal-container h2 {
            font-size: 2rem;
            margin-bottom: 24px;
        }
        .input-group {
            margin-bottom: 22px;
        }
        .input-group label {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
        }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 16px 20px;
            border-radius: 40px;
            border: 2px solid rgba(255,255,255,0.9);
            background: rgba(255,255,255,0.6);
            font-size: 1rem;
            outline: none;
        }
        .input-group textarea {
            resize: vertical;
        }
        .photo-preview-item {
            background: rgba(255,255,255,0.5);
            border-radius: 40px;
            padding: 16px;
            margin: 16px 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
        }
        .photo-preview-item img {
            width: 70px;
            height: 70px;
            border-radius: 30px;
            object-fit: cover;
            border: 2px solid white;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            margin-top: 30px;
        }

        /* –ø–æ–¥–≤–∞–ª */
        .footer {
            margin-top: 60px;
            text-align: center;
        }
        .warning-banner {
            background: #ff3b3b;
            color: white;
            font-weight: 800;
            padding: 18px;
            border-radius: 60px;
            font-size: clamp(1rem, 4vw, 1.4rem);
            letter-spacing: 1px;
            box-shadow: 0 10px 0 #9b1d1d;
            margin-bottom: 30px;
            border: 2px solid white;
        }
        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: clamp(16px, 4vw, 40px);
            font-size: 1.2rem;
            font-weight: 500;
            color: #1a1a3a;
        }

        /* –∞–¥–∞–ø—Ç–∞—Ü–∏—è <500px */
        @media (max-width: 500px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }
            .actions .btn {
                width: 100%;
                justify-content: center;
            }
            .modal-container {
                padding: 24px;
            }
            .photo-preview-item {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        .hidden { display: none; }
        input, textarea, select { font-size: 16px; } /* –æ—Ç–º–µ–Ω–∞ –∑—É–º–∞ –Ω–∞ iOS */
    </style>
</head>
<body>
<div class="app">
    <!-- –®–ê–ü–ö–ê -->
    <header class="header">
        <div class="title-block">
            <h1>–ù–û–í–û–°–¢–ò –ú–û–°–ö–í–ê</h1>
            <span class="badge">#—Ü–µ–Ω—Ç—Ä —Å—Ç–æ–ª–∏—Ü—ã</span>
        </div>
        <div class="actions">
            <button class="btn" id="viewNewsBtn">üì∞ –°–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤–æ—Å—Ç–∏</button>
            <button class="btn" id="addNewsBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
        </div>
    </header>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <main>
        <!-- –ª–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π (—Å–µ—Ç–∫–∞) -->
        <div id="newsGrid" class="news-grid"></div>

        <!-- –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (—Å–∫—Ä—ã—Ç) -->
        <div id="newsDetail" class="news-detail hidden">
            <button class="back-btn" id="backToAllBtn">‚Üê –∫–æ –≤—Å–µ–º</button>
            <div id="detailContent"></div>
        </div>
    </main>

    <!-- –ü–û–î–í–ê–õ -->
    <footer class="footer">
        <div class="warning-banner">‚ö†Ô∏è –í–°–ï –ù–û–í–û–°–¢–ò –í–´–ú–´–®–õ–ï–ù–´ (–í–ò–î–ï–û–ò–ì–†–ê) ‚ö†Ô∏è</div>
        <div class="footer-links">
            <span>üïπÔ∏è –ù–µ –∏–≥—Ä–æ–≤–æ–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä</span>
            <span>üéÆ –ß–∏—Å—Ç–æ –ø–æ –ø—Ä–∏–∫–æ–ª—É</span>
            <span>üö´ –ù–∏–∫–∞–∫–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏</span>
        </div>
    </footer>
</div>

<!-- –ú–û–î–ê–õ–¨–ù–´–ô –û–í–ï–†–õ–ï–ô (–æ–¥–∏–Ω –Ω–∞ –≤—Å—ë) -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal-container" id="modalContent"></div>
</div>

<script>
(function() {
    // ---------- –ö–õ–Æ–ß –•–†–ê–ù–ò–õ–ò–©–ê ----------
    const STORAGE_KEY = 'moscow_news_online';

    // ---------- –î–ï–ú–û-–ù–û–í–û–°–¢–ò (–±–µ–∑ —Ñ–æ—Ç–æ) ----------
    const demoNews = [
        { id: Date.now() - 100000, title: '–ú–µ—Ç—Ä–æ "–ü—Ä–æ–∫—à–∏–Ω–æ" –æ—Ç–∫—Ä—ã—Ç–æ!', shortDesc: '–ù–æ–≤–∞—è —Å—Ç–∞–Ω—Ü–∏—è –Ω–∞ —é–≥–æ-–∑–∞–ø–∞–¥–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∞ –ø–µ—Ä–≤—ã—Ö –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤.', fullText: '–°–µ–≥–æ–¥–Ω—è –º—ç—Ä –ú–æ—Å–∫–≤—ã —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ –æ—Ç–∫—Ä—ã–ª —Å—Ç–∞–Ω—Ü–∏—é "–ü—Ä–æ–∫—à–∏–Ω–æ". –≠—Ç–æ 250-—è —Å—Ç–∞–Ω—Ü–∏—è –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –º–µ—Ç—Ä–æ. –í —Ö–æ–ª–ª–∞—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã.', photos: [] },
        { id: Date.now() - 200000, title: '–§–µ—Å—Ç–∏–≤–∞–ª—å "–õ–µ—Ç–æ –≤ –ú–æ—Å–∫–≤–µ"', shortDesc: '–í –ø–∞—Ä–∫–∞—Ö —Å—Ç–∞—Ä—Ç—É—é—Ç –∫–æ–Ω—Ü–µ—Ä—Ç—ã –∏ –≥–∞—Å—Ç—Ä–æ-–ø–ª–æ—â–∞–¥–∫–∏.', fullText: '–° 1 –∏—é–Ω—è –ø–æ 1 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 20 –ø–∞—Ä–∫–∞—Ö —Å—Ç–æ–ª–∏—Ü—ã –ø—Ä–æ–π–¥—É—Ç –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è —É–ª–∏—á–Ω—ã—Ö –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –∏ —Ñ—É–¥-–∫–æ—Ä—Ç—ã.', photos: [] },
        { id: Date.now() - 300000, title: '–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª—ë–Ω', shortDesc: '–ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π.', fullText: '–û—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤—ã–µ –∑–æ–Ω—ã –æ—Ç–¥—ã—Ö–∞ —Å —à–µ–∑–ª–æ–Ω–≥–∞–º–∏, –≤–µ–ª–æ–¥–æ—Ä–æ–∂–∫–∞–º–∏ –∏ –∫–∞—Ñ–µ. –¢–µ–ø–µ—Ä—å –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –∫–∞—Ç–∞—Ç—å—Å—è –Ω–∞ —Å–∏–≥–≤–µ—è—Ö.', photos: [] },
        { id: Date.now() - 400000, title: '–°–∞–ø-–ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –ú–æ—Å–∫–≤–µ-—Ä–µ–∫–µ', shortDesc: '–ù–∞ –í–î–ù–• –æ—Ç–∫—Ä—ã–ª—Å—è –ø—Ä–æ–∫–∞—Ç —Å–∞–ø–±–æ—Ä–¥–æ–≤.', fullText: '–¢–µ–ø–µ—Ä—å –ª—é–±–æ–π –∂–µ–ª–∞—é—â–∏–π –º–æ–∂–µ—Ç –∞—Ä–µ–Ω–¥–æ–≤–∞—Ç—å —Å–∞–ø –∏ –ø—Ä–æ–ø–ª—ã—Ç—å –ø–æ –∫–∞–Ω–∞–ª—É. –°–ø–∞—Å–∞—Ç–µ–ª–∏ –¥–µ–∂—É—Ä—è—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.', photos: [] }
    ];

    // ---------- –°–û–°–¢–û–Ø–ù–ò–ï ----------
    let news = [];                  // –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ (–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ localStorage)
    let editMode = false;           // —Ä–µ–∂–∏–º —É–¥–∞–ª–µ–Ω–∏—è (–¥–æ–ª–≥–∏–π —Ç–∞–ø)
    let currentDetailId = null;     // –∫–∞–∫–∞—è –Ω–æ–≤–æ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞ –≤ –¥–µ—Ç–∞–ª–µ

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const newsGrid = document.getElementById('newsGrid');
    const newsDetail = document.getElementById('newsDetail');
    const detailContent = document.getElementById('detailContent');
    const backBtn = document.getElementById('backToAllBtn');
    const viewNewsBtn = document.getElementById('viewNewsBtn');
    const addNewsBtn = document.getElementById('addNewsBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');

    // ---------- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ----------
    function loadFromStorage() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            try { news = JSON.parse(stored); } catch { news = []; }
        }
        if (!news || news.length === 0) {
            news = [...demoNews];
        }
    }
    function saveToStorage() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(news));
    }

    // —Ä–µ–Ω–¥–µ—Ä —Å–µ—Ç–∫–∏ (—Å —É—á—ë—Ç–æ–º editMode)
    function renderGrid() {
        let html = '';
        news.forEach(item => {
            const firstPhoto = item.photos && item.photos.length > 0 ? item.photos[0].dataURL : null;
            html += `
                <div class="news-card" data-id="${item.id}">
                    ${editMode ? '<span class="delete-btn" data-id="'+item.id+'">‚úï</span>' : ''}
                    <div class="card-img">
                        ${firstPhoto ? `<img src="${firstPhoto}" alt="photo">` : 'üèôÔ∏è'}
                    </div>
                    <div class="card-title">${escapeHtml(item.title) || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                    <div class="card-desc">${escapeHtml(item.shortDesc) || ''}</div>
                </div>
            `;
        });
        newsGrid.innerHTML = html;
        // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ —Ä–µ–∂–∏–º–∞
        if (editMode) newsGrid.classList.add('edit-mode');
        else newsGrid.classList.remove('edit-mode');
    }

    // –ø—Ä–æ—Å—Ç–æ–π —ç—Å–∫–µ–π–ø –¥–ª—è —Ç–µ–∫—Å—Ç–∞ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å XSS, –Ω–æ –¥–∞–Ω–Ω—ã–µ —Å–≤–æ–∏)
    function escapeHtml(unsafe) {
        if (!unsafe) return unsafe;
        return unsafe.replace(/[&<>"]/g, function(m) {
            if(m === '&') return '&amp;'; if(m === '<') return '&lt;'; if(m === '>') return '&gt;'; if(m === '"') return '&quot;';
            return m;
        });
    }

    // —Ä–µ–Ω–¥–µ—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞
    function renderDetail(newsItem) {
        if (!newsItem) return;
        const topPhotos = (newsItem.photos || []).filter(p => p.position === 'top');
        const midPhotos = (newsItem.photos || []).filter(p => p.position === 'middle');
        const bottomPhotos = (newsItem.photos || []).filter(p => p.position === 'bottom');

        let detailHtml = `<h2 class="detail-title">${escapeHtml(newsItem.title)}</h2>`;

        // —Ñ–æ—Ç–æ —Å–≤–µ—Ä—Ö—É
        if (topPhotos.length) {
            detailHtml += '<div class="detail-photo-row">' + topPhotos.map(p => `<img src="${p.dataURL}" alt="photo">`).join('') + '</div>';
        }

        detailHtml += `<div class="detail-text">${escapeHtml(newsItem.fullText) || ''}</div>`;

        // —Ñ–æ—Ç–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ
        if (midPhotos.length) {
            detailHtml += '<div class="detail-photo-row">' + midPhotos.map(p => `<img src="${p.dataURL}" alt="photo">`).join('') + '</div>';
        }

        // —Ñ–æ—Ç–æ –≤ –∫–æ–Ω—Ü–µ
        if (bottomPhotos.length) {
            detailHtml += '<div class="detail-photo-row">' + bottomPhotos.map(p => `<img src="${p.dataURL}" alt="photo">`).join('') + '</div>';
        }

        detailContent.innerHTML = detailHtml;
        newsGrid.classList.add('hidden');
        newsDetail.classList.remove('hidden');
    }

    // –∑–∞–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π -> –ø–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É
    function showGrid() {
        newsDetail.classList.add('hidden');
        newsGrid.classList.remove('hidden');
        currentDetailId = null;
    }

    // ---------- –ú–û–î–ê–õ–ö–ò ----------
    function hideModal() {
        modalOverlay.style.display = 'none';
        modalContent.innerHTML = '';
    }

    function showPasswordModal(onSuccess) {
        // –£–±—Ä–∞–ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫—É —Å –ø–∞—Ä–æ–ª–µ–º, —Ç–µ–ø–µ—Ä—å placeholder –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π
        modalContent.innerHTML = `
            <h2>üîí –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</h2>
            <div class="input-group"><input type="password" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
            <div style="color:red; margin-bottom:16px;" id="passwordError"></div>
            <div class="modal-actions">
                <button class="btn" id="cancelPassword">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" id="submitPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        `;
        modalOverlay.style.display = 'flex';

        const passInput = document.getElementById('passwordInput');
        const errorDiv = document.getElementById('passwordError');
        document.getElementById('cancelPassword').addEventListener('click', hideModal);
        document.getElementById('submitPassword').addEventListener('click', () => {
            if (passInput.value === '8282') {
                hideModal();
                onSuccess();
            } else {
                errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
            }
        });
        // –∑–∞–∫—Ä—ã—Ç—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        modalOverlay.onclick = (e) => { if (e.target === modalOverlay) hideModal(); };
    }

    // —Ñ–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏
    function showAddModal() {
        let selectedPhotos = []; // –º–∞—Å—Å–∏–≤ { file, dataURL, position } (dataURL –≤—Ä–µ–º–µ–Ω–Ω—ã–π)

        modalContent.innerHTML = `
            <h2>‚ûï –ù–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å</h2>
            <div class="input-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input id="addTitle" placeholder="–°–æ–±—ã—Ç–∏–µ"></div>
            <div class="input-group"><label>–ö—Ä–∞—Ç–∫–æ (2 —Å—Ç—Ä–æ–∫–∏)</label><textarea id="addShort" rows="2"></textarea></div>
            <div class="input-group"><label>–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç</label><textarea id="addFull" rows="3"></textarea></div>
            <div class="input-group"><label>–§–æ—Ç–æ (–¥–æ 5 —à—Ç)</label><input type="file" id="photoInput" accept="image/*" multiple></div>
            <div id="photoPreviewList"></div>
            <div class="modal-actions">
                <button class="btn" id="cancelAdd">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" id="publishAdd">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>
        `;
        modalOverlay.style.display = 'flex';

        const photoInput = document.getElementById('photoInput');
        const previewList = document.getElementById('photoPreviewList');

        function refreshPreviews() {
            previewList.innerHTML = selectedPhotos.map((p, idx) => `
                <div class="photo-preview-item" data-index="${idx}">
                    <img src="${p.dataURL}">
                    <select class="photo-position" data-index="${idx}">
                        <option value="top" ${p.position==='top'?'selected':''}>üîù –Ω–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º</option>
                        <option value="middle" ${p.position==='middle'?'selected':''}>üìå –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ (–ø–æ —É–º–æ–ª—á.)</option>
                        <option value="bottom" ${p.position==='bottom'?'selected':''}>üîö –≤ –∫–æ–Ω—Ü–µ</option>
                    </select>
                    <button class="btn" data-remove="${idx}">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');

            document.querySelectorAll('.photo-position').forEach(sel => {
                sel.addEventListener('change', (e) => {
                    const idx = e.target.dataset.index;
                    if (selectedPhotos[idx]) selectedPhotos[idx].position = e.target.value;
                });
            });
            document.querySelectorAll('[data-remove]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = e.target.dataset.remove;
                    selectedPhotos.splice(idx, 1);
                    refreshPreviews();
                });
            });
        }

        photoInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (selectedPhotos.length + files.length > 5) {
                alert('–ú–∞–∫—Å–∏–º—É–º 5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π');
                return;
            }
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    selectedPhotos.push({ dataURL: ev.target.result, position: 'middle' });
                    refreshPreviews();
                };
                reader.readAsDataURL(file);
            });
        });

        document.getElementById('cancelAdd').addEventListener('click', hideModal);
        document.getElementById('publishAdd').addEventListener('click', () => {
            const title = document.getElementById('addTitle').value.trim() || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            const shortDesc = document.getElementById('addShort').value.trim() || '...';
            const fullText = document.getElementById('addFull').value.trim() || '...';
            const photosForSave = selectedPhotos.map(p => ({ dataURL: p.dataURL, position: p.position }));

            const newNews = {
                id: Date.now(),
                title, shortDesc, fullText,
                photos: photosForSave,
            };
            news = [newNews, ...news];
            saveToStorage();
            renderGrid();
            hideModal();
            // –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É
            showGrid();
        });

        modalOverlay.onclick = (e) => { if (e.target === modalOverlay) hideModal(); };
    }

    // ---------- –£–î–ê–õ–ï–ù–ò–ï (–ü–û –ö–†–ï–°–¢–ò–ö–£) ----------
    function deleteNewsById(id) {
        news = news.filter(n => n.id != id);
        saveToStorage();
        renderGrid();    // –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–µ—Ç–∫—É, editMode –æ—Å—Ç–∞—ë—Ç—Å—è
        if (currentDetailId == id) showGrid(); // –µ—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—É—é –¥–µ—Ç–∞–ª—å–Ω—É—é ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–µ—Ç–∫–µ
    }

    // ---------- –î–û–õ–ì–û–ï –ù–ê–ñ–ê–¢–ò–ï (EDIT MODE) ----------
    let longPressTimer = null;
    function startLongPress(e) {
        e.preventDefault(); // –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        if (longPressTimer) clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => {
            editMode = !editMode;
            renderGrid(); // –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä —Å –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏/–±–µ–∑
            longPressTimer = null;
        }, 1000);
    }
    function cancelLongPress() {
        if (longPressTimer) {
            clearTimeout(longPressTimer);
            longPressTimer = null;
        }
    }

    // ---------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ----------
    loadFromStorage();
    renderGrid();

    // ---------- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ----------
    // –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤–æ—Å—Ç–∏"
    viewNewsBtn.addEventListener('mousedown', startLongPress);
    viewNewsBtn.addEventListener('mouseup', cancelLongPress);
    viewNewsBtn.addEventListener('mouseleave', cancelLongPress);
    viewNewsBtn.addEventListener('touchstart', startLongPress, { passive: false });
    viewNewsBtn.addEventListener('touchend', cancelLongPress);
    viewNewsBtn.addEventListener('touchcancel', cancelLongPress);

    // –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏ (—Å–Ω–∞—á–∞–ª–∞ –ø–∞—Ä–æ–ª—å)
    addNewsBtn.addEventListener('click', () => {
        showPasswordModal(() => {
            showAddModal();
        });
    });

    // –∫–ª–∏–∫ –ø–æ —Å–µ—Ç–∫–µ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
    newsGrid.addEventListener('click', (e) => {
        // –∫—Ä–µ—Å—Ç–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è
        if (e.target.classList.contains('delete-btn')) {
            e.stopPropagation();
            const id = e.target.dataset.id;
            showPasswordModal(() => {
                deleteNewsById(id);
            });
            return;
        }
        // –∫–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ (–æ—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å)
        const card = e.target.closest('.news-card');
        if (card) {
            const id = card.dataset.id;
            const selected = news.find(n => n.id == id);
            if (selected) {
                currentDetailId = id;
                renderDetail(selected);
            }
        }
    });

    // –Ω–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
    backBtn.addEventListener('click', showGrid);

    // –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ —Ñ–æ–Ω—É —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–∞–∂–¥–æ–π –º–æ–¥–∞–ª–∫–µ –æ—Ç–¥–µ–ª—å–Ω–æ (onclick)

    // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –æ—Å—Ç–∞–ª—Å—è –º–æ–¥–∞–ª –æ–≤–µ—Ä–ª–µ–π, –∫–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É ‚Äî –∑–∞–∫—Ä—ã—Ç—å
    window.addEventListener('click', (e) => {
        if (e.target === modalOverlay) hideModal();
    });

    // –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–µ–º–æ —Å–æ—Ö—Ä–∞–Ω–∏–º, –µ—Å–ª–∏ localStorage –ø—É—Å—Ç (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ load)
    // –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–æ—Ö—Ä–∞–Ω–∏–º –¥–µ–º–æ –≤ localStorage –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
    if (!localStorage.getItem(STORAGE_KEY)) {
        saveToStorage();
    }

    // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Å—Å–∏–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
    // —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)
})();
</script>
</body>
</html>
